---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import FadeIn from '../components/FadeIn.astro'; 
import { getCollection } from 'astro:content';
import Card from '../components/Card.astro';

const blogEntries = await getCollection('blog');
const projectEntries = await getCollection('projects');
const courseEntries = (await getCollection('courses')).filter(
  (course) => course.id.endsWith('index.mdx') || course.id.endsWith('index.md')
);

const allContent = [
  ...blogEntries.map(entry => ({
    type: 'blog' as const,
    title: entry.data.title,
    description: entry.data.description,
    href: `/blog/${entry.slug}/`,
    tags: entry.data.tags,
    publishDate: entry.data.publishDate,
    heroImage: entry.data.heroImage,
    featured: entry.data.featured,
  })),
  ...projectEntries.map(entry => ({
    type: 'project' as const,
    title: entry.data.title,
    description: entry.data.description,
    href: `/projects/${entry.slug}/`,
    tags: entry.data.tags,
    publishDate: entry.data.publishDate,
    heroImage: entry.data.heroImage,
    featured: entry.data.featured,
  })),
  ...courseEntries.map(entry => ({
    type: 'course' as const,
    title: entry.data.title,
    description: entry.data.description,
    href: `/courses/${entry.slug.replace(/\/index$/, '')}/`,
    tags: entry.data.tags || [],
    publishDate: entry.data.publishDate,
    heroImage: entry.data.heroImage,
    featured: entry.data.featured,
  })),
];

const fallbackDate = new Date('1970-01-01');

const featuredContentRaw = allContent
  .filter(item => item.featured)
  .sort((a, b) => (
    (b.publishDate ? new Date(b.publishDate) : fallbackDate).valueOf() -
    (a.publishDate ? new Date(a.publishDate) : fallbackDate).valueOf()
  ));

const recentFallback = allContent
  .filter(item => !item.featured)
  .sort((a, b) => (
    (b.publishDate ? new Date(b.publishDate) : fallbackDate).valueOf() -
    (a.publishDate ? new Date(a.publishDate) : fallbackDate).valueOf()
  ));

const featuredContent = (featuredContentRaw.length >= 4
  ? featuredContentRaw.slice(0, 4)
  : [...featuredContentRaw, ...recentFallback].slice(0, 4)
);

const seo = {
  title: "Home",
  description: "Welcome to the professional portfolio of Faisal Durbaa. Discover projects, writings, and more."
};
---
<Layout seo={seo}>
  <Hero />

  <!-- Floating Scroll Indicator -->
  <div id="scroll-indicator" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-40 transition-all duration-500 ease-out cursor-pointer hover:scale-105 hidden md:flex flex-col items-center">
    <div class="w-11 h-11 flex items-center justify-center rounded-full bg-white/85 backdrop-blur-md shadow-md border border-gray-200/50 text-gray-400 hover:text-accent transition-colors animate-bounce">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
      </svg>
    </div>
  </div>

  <section id="featured-section" class="py-16">
    <div class="container mx-auto px-4 max-w-6xl space-y-10">
      <FadeIn>
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <p class="text-sm font-semibold text-accent uppercase tracking-wide">Featured</p>
            <h2 class="text-3xl font-bold text-gray-900">Top work right now</h2>
            <p class="text-gray-600">Four highlights across projects, courses, and blogs.</p>
          </div>
        </div>
      </FadeIn>

      <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 items-stretch">
        {featuredContent.map(item => (
          <FadeIn>
            <Card
              title={item.title}
              description={item.description}
              href={item.href}
              tags={item.tags ?? []}
              type={item.type}
              publishDate={item.publishDate}
              heroImage={item.heroImage}
            />
          </FadeIn>
        ))}
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-8">
        <a href="/projects/" class="group relative overflow-hidden rounded-2xl bg-white/60 p-6 shadow-lg backdrop-blur-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:bg-white/80 border border-white/50">
          <div class="absolute -right-6 -top-6 h-24 w-24 rounded-full bg-blue-100/50 blur-2xl transition-all duration-500 group-hover:bg-blue-200/50"></div>
          
          <div class="relative z-10 flex items-center justify-between mb-4">
            <div class="rounded-full bg-white/80 p-3 shadow-sm text-accent ring-1 ring-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
              </svg>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform duration-300 group-hover:translate-x-1 group-hover:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          
          <h3 class="relative z-10 text-xl font-bold text-gray-900 group-hover:text-accent transition-colors">Projects</h3>
          <p class="relative z-10 mt-2 text-sm text-gray-600 leading-relaxed">
            Explore my latest builds, competition entries, and technical courses.
          </p>
        </a>

        <a href="/blog/" class="group relative overflow-hidden rounded-2xl bg-white/60 p-6 shadow-lg backdrop-blur-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:bg-white/80 border border-white/50">
          <div class="absolute -right-6 -top-6 h-24 w-24 rounded-full bg-purple-100/50 blur-2xl transition-all duration-500 group-hover:bg-purple-200/50"></div>

          <div class="relative z-10 flex items-center justify-between mb-4">
            <div class="rounded-full bg-white/80 p-3 shadow-sm text-accent ring-1 ring-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
              </svg>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform duration-300 group-hover:translate-x-1 group-hover:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          
          <h3 class="relative z-10 text-xl font-bold text-gray-900 group-hover:text-accent transition-colors">Blogs</h3>
          <p class="relative z-10 mt-2 text-sm text-gray-600 leading-relaxed">
            Read notes on AI developments, software engineering, and experiments.
          </p>
        </a>

        <a href="/contact/" class="group relative overflow-hidden rounded-2xl bg-white/60 p-6 shadow-lg backdrop-blur-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:bg-white/80 border border-white/50">
          <div class="absolute -right-6 -top-6 h-24 w-24 rounded-full bg-emerald-100/50 blur-2xl transition-all duration-500 group-hover:bg-emerald-200/50"></div>

          <div class="relative z-10 flex items-center justify-between mb-4">
            <div class="rounded-full bg-white/80 p-3 shadow-sm text-accent ring-1 ring-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform duration-300 group-hover:translate-x-1 group-hover:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </div>
          
          <h3 class="relative z-10 text-xl font-bold text-gray-900 group-hover:text-accent transition-colors">Contact</h3>
          <p class="relative z-10 mt-2 text-sm text-gray-600 leading-relaxed">
            Reach out for collaborations, questions, or just to say hello.
          </p>
        </a>
      </div>
    </div>
  </section>
</Layout>

<script>
  function setupScrollIndicator() {
    const scrollIndicator = document.getElementById('scroll-indicator');
    const featuredSection = document.getElementById('featured-section');
    if (!scrollIndicator || !featuredSection || scrollIndicator.dataset.bound === 'true') return;

    scrollIndicator.dataset.bound = 'true';

    scrollIndicator.addEventListener('click', () => {
      featuredSection.scrollIntoView({ behavior: 'smooth' });
    });

    const onScroll = () => {
      const scrollY = window.scrollY;
      if (scrollY > 100) {
        scrollIndicator.style.opacity = '0';
        scrollIndicator.style.pointerEvents = 'none';
        scrollIndicator.style.transform = 'translate(-50%, 20px)';
      } else {
        scrollIndicator.style.opacity = '1';
        scrollIndicator.style.pointerEvents = 'auto';
        scrollIndicator.style.transform = 'translate(-50%, 0)';
      }
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  }

  if (typeof window !== 'undefined') {
    setupScrollIndicator();
    document.addEventListener('astro:after-swap', () => {
      // allow rebind after swap
      const indicator = document.getElementById('scroll-indicator');
      if (indicator) indicator.dataset.bound = 'false';
      setupScrollIndicator();
    });
  }
</script>
